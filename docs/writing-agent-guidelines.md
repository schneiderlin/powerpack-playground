# 写作 Agent 指导文档

本文记录了在交互式写作过程中积累的经验和教训，作为未来写作 agent 的参考。

## 文件组织结构

### 大纲 vs 文章

- **大纲**放在 `docs/` 目录
- **文章**放在 `content/blog-posts/` 目录

示例：
```
docs/ai-eval-blog-outline.md          # 大纲
content/blog-posts/ai-eval-system-introduction.md  # 文章
content/blog-posts/ai-eval-system-scorer.md        # 文章
```

## Meta Data 格式

每篇文章的开头必须包含以下 meta data（参考现有博客文章）：

```edn
:page/title "文章标题"
:page/description "简短描述，1-2句话概括文章内容"
:page/date "YYYY-MM-DD"
:blog-post/tags [:tag1 :tag2 :tag3]
:blog-post/author {:person/id :jan}
:page/body
```

注意：
- tags 使用 keyword 格式，如 `[:clojure :linter :malli]`
- author 保持 `{:person/id :jan}`
- date 使用 ISO 格式

## 抽象层次的一致性

### 原则

不同文章应该保持一致的抽象层次。

### 实践

- **主文章**：讨论概念、原则、方法论
- **技术细节文章**：讨论具体实现、代码示例、配置细节

### 示例

**错误做法**：
- 在 `ai-eval-system-scorer.md`（主文章）中塞进大量 Clojure Malli + clj-kondo 的实现细节

**正确做法**：
- `ai-eval-system-scorer.md` 讨论确定性评分的优势
- 新建 `malli-cljkondo-type-export.md` 专门讨论实现细节
- 主文章用一句话引用：`具体实现细节见 [malli-cljkondo-type-export](./malli-cljkondo-type-export.md)`

### 如何判断

问自己：
- 这段内容是"概念性"的还是"实现细节"？
- 如果是后者，应该放在单独的文章，主文章只做引用

## Digital Garden 写作风格

### 原则

- 不追求完美
- 迭代和生长
- 半成品状态

### 实践

- 不要写"总结"章节（除非用户明确要求）
- 删除"但是..."这种转折章节（除非有必要）
- 文章可以是未完成的，以后再补充

### 示例

不要写：
```markdown
## 总结
- 要点1
- 要点2
- 要点3
```

让文章自然结束，最后一段话点题即可。

## 引用管理

### 原则

- 用 markdown 链接引用相关文章
- 避免重复内容

### 实践

```markdown
关于这个思考的详细讨论，见 [strong-vs-dynamic-types-ai-codegen](./strong-vs-dynamic-types-ai-codegen.md)。

具体实现细节见 [malli-cljkondo-type-export](./malli-cljkondo-type-export.md)。
```

### 引用时机

- 当内容过长，应该拆分到单独文章时
- 当技术细节会影响主文章的抽象层次时
- 当用户明确要求"把这个思考也放单独文章"时

## 交互式写作流程

### 典型流程

1. **写初稿**：根据用户要求写出完整内容
2. **用户反馈**：用户指出问题或要求修改
3. **立即修改**：根据反馈调整内容
4. **重复迭代**：直到用户满意

### 关键点

- 每次用户反馈后，**立即**做修改
- 不要等多次反馈后再一次性修改
- 保持短回应，不解释做了什么修改（除非用户问）

### 示例

用户：不行，放在这不对，文章的抽象层次不一样，把技术细节放的一个单独的文章里面

Agent：（立即）[写新文章，更新主文章引用，删除主文章中的技术细节]

## 用户指令的理解

### 常见模式

| 用户指令 | 行为 |
|---------|------|
| "不要总结" | 删除"## 总结"章节 |
| "引用上那个文章" | 在合适位置添加 `[文章名](./path)` |
| "放到 docs/ 里面" | 修改目标目录为 `docs/` |
| "移到 content/blog-posts/" | 修改目标目录为 `content/blog-posts/` |
| "写一个单独的文章" | 新建文件，在原文章中添加引用 |
| "改一下路径" | 修改路径相关的配置和文档 |

### 注意

- 用户的"改一下"意味着要做改动，不是询问
- 用户的引用指令意味着要添加链接，不是复制内容
- 用户说的"单独文章"意味着要新建文件，不是在当前文章添加章节

## Git 工作流

### Commit 流程

1. **检查状态**：`git status`, `git diff`, `git log`
2. **Add 文件**：`git add file1 file2 ...`
3. **Commit**：`git commit -m "message"`
4. **验证**：`git status`

### Commit message 风格

- 简洁，1-2 句话
- 描述做了什么，不是为什么做

示例：
```
add deterministic scoring and type systems posts
```

### 不要做的事

- 不要在 commit 前解释"我现在要 commit 了"
- 不要 push（除非用户明确要求）
- 不要修改 git config

## 常见错误

### 1. 抽象层次混乱

**错误**：在主文章中塞进大量实现细节

**解决**：
- 判断内容是"概念性"还是"实现细节"
- 如果是后者，新建单独文章
- 主文章用一句话引用

### 2. 不必要的章节

**错误**：写"## 但是，也有优势"和"## 总结"

**解决**：
- 用户明确要求时才保留
- Digital Garden 风格不需要总结

### 3. 引用 vs 复制

**错误**：用户说"引用那个文章"，结果把内容复制过来了

**解决**：
- 用 `[文章名](./path)` 引用
- 不复制内容

### 4. 过度解释

**错误**：修改完文章后说"我已经修改了文章，删除了XXX章节，添加了XXX引用"

**解决**：
- 直接说"完成"
- 不解释做了什么修改

### 5. 语法错误

**错误**：`return max(0, 1 - len(errors) / MAX_TOLERATED_ERRORS))` 多了一个 `)`

**解决**：
- 仔细检查代码
- 用户指出后立即修复

## 写作技巧

### 1. 代码示例

- 用代码块标记语言：` ```python ` 或 ` ```clojure `
- 代码要简洁，只展示关键部分
- 注释用目标语言的注释风格

### 2. 表格

用于对比时使用表格：

```markdown
| 维度 | 评分方式 | 适用场景 |
|------|---------|---------|
| Syntax 正确性 | Parse → 是否报错 | 代码、JSON、SQL |
```

### 3. 标题层级

- `#` 只在文章开头用一次（如果需要）
- 主要章节用 `##`
- 子章节用 `###`
- 不要超过 3 层

### 4. 链接格式

```markdown
[display text](./relative-path)
```

## 沟通原则

### 简洁回应

- 用 1-2 句话回应
- 不做无谓的解释

### 不做推测

用户没说的事不要主动做：
- 不要问"你要不要...?"
- 不要主动加总结
- 不要主动 push 到 remote

### 等待指令

- 每次修改后停止，等待用户下一步指令
- 不要连续做多个动作（除非它们是独立的且可以并行）

## 检查清单

完成写作后，检查：

- [ ] 文件在正确的目录（`docs/` 或 `content/blog-posts/`）
- [ ] Meta data 格式正确
- [ ] 没有不必要的"总结"章节
- [ ] 没有抽象层次混乱的问题
- [ ] 引用使用了正确的链接格式
- [ ] 代码没有语法错误
- [ ] 响应简洁（1-2 句话）

## 持续改进

本文档本身也是 living document。当发现新的经验或教训时，及时更新。
